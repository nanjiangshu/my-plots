<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Plots Gallery</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; background: #fdfdfd; }
    h1 { text-align: center; }
    .folder { margin-bottom: 40px; }
    .folder h2 { margin-bottom: 10px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
    img { max-width: 600px; margin: 10px 0; display: block; }
  </style>
</head>
<body>
  <h1>ðŸ“Š My Plots Gallery</h1>
  <div id="gallery"></div>

  <script>
    const repo = "nanjiangshu/my-plots";
    const apiUrl = `https://api.github.com/repos/${repo}/contents/plots/`;


    async function fetchJSON(url) {
      const res = await fetch(url);
      return res.json();
    }

    async function loadGallery() {
      const root = await fetchJSON(apiUrl);

      // Filter only timestamped folders
      let folders = root.filter(f => f.type === "dir");

      // Sort folders descending by name (timestamps: latest first)
      folders.sort((a, b) => b.name.localeCompare(a.name));

      // show total folder count at the top
      const gallery = document.getElementById("gallery");
      const folderCountInfo = document.createElement("p");
      folderCountInfo.textContent = `Found ${folders.length} folders.`;
      gallery.appendChild(folderCountInfo);

      for (const folder of folders) {
        const files = await fetchJSON(apiUrl + folder.name);
        const images = files.filter(f => f.name.endsWith(".png"));

        if (images.length === 0) continue;

        const section = document.createElement("div");
        section.className = "folder";
        section.innerHTML = `<h2>${folder.name}</h2>`;

        for (const img of images) {
          const el = document.createElement("img");
          el.src = `https://raw.githubusercontent.com/${repo}/main/plots/${img.path}`;
          el.alt = img.name;
          section.appendChild(el);
        }

        document.getElementById("gallery").appendChild(section);
      }
    }

    loadGallery();
  </script>
</body>
</html>
